'''BadUSB''' — класс [[Хакерская атака|хакерских атак]], основанный на уязвимости [[USB|USB устройств]]. Благодаря отсутствию защиты от перепрошивки в некоторых USB-устройствах, злоумышленник может видоизменить или полностью заменить оригинальную [[Встроенное программное обеспечение|прошивку]] и заставить устройство имитировать любое другое устройство. BadUSB предназначен для доставки и исполнения вредоносного кода<ref name=":3">{{Cite web|url = https://www.blackhat.com/us-14/briefings.html#badusb-on-accessories-that-turn-evil|title = Брифинг BlackHat USA|date =2014 |lang = en |accessdate = 2014-12-10}}</ref>.

== Описание ==
USB устройства несут в себе [[микроконтроллер]], отвечающий за общение с [[хост]]ом по интерфейсу USB. В процессе инициализации микроконтроллер сообщает хосту, наряду с другой служебной информацией, [[USB HID|классы]], к которым принадлежит устройство. Хост загружает нужный драйвер и работает с устройством исходя из его класса и этих данных. Одно физическое устройство может реализовывать несколько классов и для хоста являться несколькими отдельными устройствами: веб-камеры реализуют одновременно класс видео и класс аудио устройств<ref name=":14">{{Cite web|url = http://www.usb.org/developers/docs/|title = Спецификация USB |lang =en |accessdate = 2014-12-10}}</ref>.

BadUSB пользуется тем фактом, что производители не защищают свои устройства от перепрошивки, а хосты не проверяют USB устройства на подлинность. Благодаря этому злоумышленник может подменить прошивку микроконтроллера и выдать одно устройство за другое. Также, так как все коммуникации ведутся через этот микроконтроллер, злоумышленник может перехватывать и подменять любые данные и команды между устройством и хостом<ref name=":4" />. Возможно и автоматическое заражение устройств: устройство заражает хост, запуская на нём вредоносное ПО, затем хост автоматически заражает все подключенные к нему USB устройства<ref name=":4" />.

Каждый контроллер уникален, и для каждого необходимо разрабатывать зараженную прошивку или патч отдельно. Невозможно написать универсальное программное обеспечение и использовать его на любом микроконтроллере. Процедура прошивки различается от одного контроллера к другому. Все это значительно уменьшает вероятность эпидемии BadUSB, однако не защищает от целенаправленной атаки<ref name=":4">{{Статья|автор = Andy Greenberg|заглавие = Why the Security of USB Is Fundamentally Broken|издание = wired.com|год = 2014|язык = en|ссылка = http://www.wired.com/2014/07/usb-security/ |accessdate = 2014-12-10}}</ref>.

== История ==
Понятие BadUSB было введено в августе 2014 года на конференции [http://www.blackhat.com/us-14/ BlackHat USA 2014] исследователями организации [https://srlabs.de Security Research Labs] Карстеном Нолом ({{lang-en|Karsten Nohl}}) и Джейкобом Леллом ({{lang-en|Jakob Lell}}), которые выступили с докладом «BadUSB — On Accessories that Turn Evil». Они провели [[Обратная разработка|реинжениринг]] USB контроллера [http://www.phison.com/English/ProductView.asp?ID=235&SortID=60 Phison 2251-03 (2303)] и разработали прошивки для некоторых видов атак. Прошивка контроллера осуществлялась приложением [https://github.com/adamcaudill/Psychson/tree/master/DriveCom DriveCom]. Была продемонстрирована атака с помощью имитации клавиатуры, сетевой карты, атака на защиту флеш-накопителей и сокрытие раздела флеш-накопителя. Также были рассмотрены некоторые способы защиты от атак BadUSB<ref name=":3" /><ref name=":4" />.

5 августа 2014 года был опубликован [[эксплойт]] [https://srlabs.de/badusb/ BadAndroid], превращающий телефон на базе Android в [[Анализатор трафика|сниффер]] сетевого трафика<ref>{{Cite web|url = https://srlabs.de/badusb/|title = BadUSB на Security Research Lab  |accessdate = 2014-12-10 }}</ref>.

26 сентября 2014 года был опубликован [https://github.com/adamcaudill/Psychson исходный код] прошивки и патчей для контроллера Phison 2251-03, включая атаку имитацией клавиатуры, атаку на пароль накопителя и скрытие раздела накопителя<ref>{{Статья|автор = Andy Greenberg|заглавие = The Unpatchable Malware That Infects USBs Is Now on the Loose|издание = wired.com|год = 2014|язык = en|ссылка = http://www.wired.com/2014/10/code-published-for-unfixable-usb-attack/ |accessdate = 2014-12-10}}</ref>.

== Область уязвимости ==
Уязвимости подвержены все устройства с незащищенными USB контроллерами на борту: [[USB-флеш-накопитель|флеш-накопители]], [[Вебкамера|вебкамеры]], [[компьютерная мышь|мышки]], [[Клавиатура|клавиатуры]], [[Android|андроид-устройства]]. BadUSB не требует особого программного обеспечения на компьютере жертвы и работает под любыми операционными системами, поддерживающими [[USB HID|USB-HID]] устройства<ref name=":4" /><ref name=":1">{{Статья|автор = Andy Greenberg|заглавие = Only Half of USB Devices Have an Unpatchable Flaw, But No One Knows Which Half|издание = wired.com|год = 2014|ссылка = http://www.wired.com/2014/11/badusb-only-affects-half-of-usbs/|язык = en |accessdate = 2014-12-10}}</ref>.

Необходимость трудоемкого реверс-инжиниринга каждого USB-устройства ограничивает этот класс атак заказными атаками на конкретные устройства в рамках черных пиар-технологий либо атаками против конкретной жертвы, пользующейся определенными устройствами.

== Некоторые виды атак ==

=== Имитация клавиатуры ===
Устройство представляется компьютеру жертвы клавиатурой, а по истечении некоторого времени начинает отправлять последовательности нажатий клавиш. В результате злоумышленник может выполнить на компьютере жертвы любые действия, доступные авторизованному пользователю с помощью одной только клавиатуры. К примеру, злоумышленник может загрузить из интернета и запустить вредоносное ПО<ref name=":4" />.

Существенным минусом данного вида атак является отсутствие доступа к информации на экране и, как следствие, отсутствие обратной связи на любые действия со стороны зараженного устройства. Например, злоумышленник не может определить как текущую раскладку клавиатуры, так и произведен ли вход в систему<ref name=":4" />.

=== Имитация сетевой карты ===
Устройство представляется компьютеру жертвы сетевой картой и, таким образом, может перехватывать или перенаправлять сетевой трафик. В частности, отвечая на DHCP запрос адресом DNS сервера злоумышленника и не предоставляя шлюза по умолчанию, злоумышленник может перенаправить трафик жертвы: компьютер жертвы будет производить разрешение адреса через DNS сервер злоумышленника, но, в отсутствии шлюза по умолчанию, будет использовать другой, настоящий сетевой интерфейс<ref name=":4" />.

=== Boot Injection ===
Устройство с достаточным местом для хранения вредоносного кода, например, флеш-накопитель, может определить момент включения компьютера и в момент определения BIOS’ом выдать на загрузку вирус для заражения операционной системы. Это становится возможным благодаря тому, что по поведению хоста при общении с USB микроконтроллером возможно определить ОС хоста, в частности [[Windows]], [[Linux]], [[MacOS X|MacOSX]], а также [[BIOS]]<ref name=":0" />.

=== Выход из виртуального окружения ===
Атака использует возможность повторной инициализации устройства<ref name=":14" />. Выполняясь в виртуальной машине, вирус заражает любое подключенное по USB устройство. Зараженная прошивка выполняет переинициализацию и представляется двумя независимыми устройствами: неким новым и тем, которое уже было подключено к виртуальной машине. Новое устройство будет автоматически подключено к хостовой ОС, а старое — обратно в виртуальную машину. Таким образом, может быть произведен выход за пределы виртуального окружения, то есть осуществлен переход от клиентской до хостовой ОС<ref name=":0" />.

== Противодействие ==
В рамках доклада «BadUSB — On Accessories that Turn Evil» было предложено несколько способов защиты от BadUSB, однако, по словам исследователей, полноценная интеграция защиты займет продолжительное время<ref name=":4" /><ref name=":0">{{Cite web|url = https://srlabs.de/blog/wp-content/uploads/2014/07/SRLabs-BadUSB-BlackHat-v1.pdf|title = Слайды доклада BadUSB|date = август 2014 |accessdate = 2014-12-10}}</ref>.

Одним из возможных способов противостояния является подпись прошивки производителем оборудования и соответствующая проверка на стороне хоста перед использованием устройства, что не предусмотрено текущей спецификацией USB. Другим решением проблемы может стать блокировка возможности перепрошивки устройств самим производителем<ref name=":14" /><ref name=":1" />.

[[Шаттлворт, Марк|Марк Шаттлворт]], основатель [[Canonical Ltd.]], также высказывался по вопросу безопасности USB устройств и как решение проблемы предлагал полностью открыть исходный код прошивок<ref name="linux-mag-162">Linux Magazine issue 162, May 2014, page 9.</ref>.

Несмотря на то, что ряд средств комплексной антивирусной защиты, такие как [[ESET Endpoint Antivirus]], [[Kaspersky Endpoint Security]], компонент «Родительский контроль» у [[Dr.Web AV-Desk]], позволяют ограничивать доступ к сменным носителям и разрешать активацию согласно «белому списку», в случае с Bad USB, таких мер недостаточно. Пользователь сам может разрешить подключение опасного устройства, ошибочно посчитав его безопасным. По утверждению корреспондента «[[Компьютерра|Компьютерры]]» Андрея Василькова, разработчики антивирусных решений будут вынуждены в будущем добавить «отдельные модули для более гибкого дополнительного контроля над подключаемыми по USB устройствами»<ref>{{cite web|url=http://www.computerra.ru/108106/bad-usb-on-some-devices/|title=Bad USB — как новая атака реализована в разных устройствах|author=Андрей Васильков|date=6 октября 2014|publisher=[[Компьютерра]]|accessdate=2014-12-27}}</ref>.

== Примечания ==
{{примечания}}

== Ссылки ==
* {{cite web
 | url         = https://srlabs.de/badusb/
 | title       = Security Research Labs: BadUSB
 | description = крактое описание BadUSB на Security Research Labs
 | lang        = en
}}

* {{cite web
 | url         = https://www.youtube.com/watch?v=nuruzFqMgIw
 | title       = BlackHat USA 2014: BadUSB - On Accessories that Turn Evil
 | description = видео доклада «BadUSB - On Accessories that Turn Evil» на конференции BlackHat USA 2014
 | lang        = en
}}

* {{cite web
 | url         = https://srlabs.de/blog/wp-content/uploads/2014/07/SRLabs-BadUSB-BlackHat-v1.pdf
 | title       = Security Research Labs: BadUSB Slides
 | description = слайды доклада «BadUSB - On Accessories that Turn Evil» на конференции BlackHat USA 2014
 | lang        = en
}}

* {{cite web
 | url         = https://github.com/adamcaudill/Psychson
 | title       = BadUSB Sources
 | lang        = en
|description = опубликованный исходный код некоторых уязвимостей, продемонстрированных в докладе «BadUSB - On Accessories that Turn Evil»}}

{{Добротная статья|Компьютеры}}

[[Категория:Уязвимости защиты]]
[[Категория:Информационная безопасность]]